<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Strict Mapping | Yiming @ SeasonsRoad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Get ready, because things are about to get a little wild.
So far we’ve used map, nmap, vmap, and imap to create key mappings that will save time.  These work, but they have a downside.  Run the follow">
<meta property="og:type" content="website">
<meta property="og:title" content="Strict Mapping">
<meta property="og:url" content="http://blog.seasonsroad.com/LearnVimScriptTheHardWay/05.html">
<meta property="og:site_name" content="Yiming @ SeasonsRoad">
<meta property="og:description" content="Get ready, because things are about to get a little wild.
So far we’ve used map, nmap, vmap, and imap to create key mappings that will save time.  These work, but they have a downside.  Run the follow">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Strict Mapping">
<meta name="twitter:description" content="Get ready, because things are about to get a little wild.
So far we’ve used map, nmap, vmap, and imap to create key mappings that will save time.  These work, but they have a downside.  Run the follow">
  
    <link rel="alternative" href="/atom.xml" title="Yiming @ SeasonsRoad" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-nav" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Good Morning!</a>
      </h1>
      <nav id="main-nav">
        <ul class="mod-head__ul">
        
          <li class="main-nav-link"><a href="/">Home</a></li>
        
          <li class="main-nav-link"><a href="/links.html">Links</a></li>
        
          <li class="main-nav-link"><a href="https://github.com/yiminglu">Github</a></li>
        
          <li class="main-nav-link"><a href="/about.html">About</a></li>
        
        </ul>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="inner">
        <section id="main"><article id="page-undefined" class="article article-type-page" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      <a href="/LearnVimScriptTheHardWay/05.html">
        Strict Mapping
      </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Get ready, because things are about to get a little wild.</p>
<p>So far we’ve used <code>map</code>, <code>nmap</code>, <code>vmap</code>, and <code>imap</code> to create key mappings that will save time.  These work, but they have a downside.  Run the following commands:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:nmap - dd</span><br><span class="line"></span><br><span class="line">:nmap \ -</span><br></pre></td></tr></table></figure>
<p>Now try pressing <code>\</code> (in normal mode).  What happens?</p>
<p>When you press <code>\</code> Vim sees the mapping and says “I should run <code>-</code> instead”. But we’ve already mapped <code>-</code> to do something else!  Vim sees that and says “oh, now I need to run <code>dd</code>“, and so it deletes the current line.</p>
<p>When you map keys with these commands Vim will take <em>other</em> mappings into account.  This may sound like a good thing at first but in reality it’s pure evil.  Let’s talk about why, but first remove those mappings by running the following commands:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:nunmap -</span><br><span class="line"></span><br><span class="line">:nunmap \</span><br></pre></td></tr></table></figure>
<h2 id="Recursion">Recursion</h2><p>Run this command:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:nmap dd O&lt;esc&gt;jddk</span><br></pre></td></tr></table></figure>
<p>At first glance it might look like this would map <code>dd</code> to:</p>
<ul>
<li>Open a new line above this one. <em> Exit insert mode. </em> Move back down. <em> Delete the current line. </em> Move up to the blank line just created.</li>
</ul>
<p>Effectively this should “clear the current line”.  Try it.</p>
<p>Vim will seem to freeze when you press <code>dd</code>.  If you press <code>&lt;c-c&gt;</code> you’ll get Vim back, but there will be a ton of empty lines in your file!  What happened?</p>
<p>This mapping is actually <em>recursive</em>!  When you press <code>dd</code>, Vim says:</p>
<ul>
<li><p><code>dd</code> is mapped, so perform the mapping.</p>
</li>
<li><p>Open a line.</p>
</li>
<li><p>Exit insert mode.</p>
</li>
<li><p>Move down a line.</p>
</li>
<li><p><code>dd</code> is mapped, so perform the mapping.</p>
</li>
<li><p>Open a line.</p>
</li>
<li><p>Exit insert mode.</p>
</li>
<li><p>Move down a line.</p>
</li>
<li><p><code>dd</code> is mapped, so perform the mapping, and so on.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;This mapping can never finish running!  Go ahead and remove this terrible thing with the following command:&#10;&#10;````vim&#10;:nunmap dd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Side_Effects">Side Effects</h2><p>One downside of the <code>*map</code> commands is the danger of recursing.  Another is that their behavior can change if you install a plugin that maps keys they depend on.</p>
<p>When you install a new Vim plugin there’s a good chance that you won’t use and memorize every mapping it creates.  Even if you do, you’d have to go back and look through your <code>~/.vimrc</code> file to make sure none of your custom mappings use a key that the plugin has mapped.</p>
<p>This would make installing plugins tedious and error-prone.  There must be a better way.</p>
<h2 id="Nonrecursive_Mapping">Nonrecursive Mapping</h2><p>Vim offers another set of mapping commands that will <em>not</em> take mappings into account when they perform their actions.  Run these commands:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:nmap x dd</span><br><span class="line"></span><br><span class="line">:nnoremap \ x</span><br></pre></td></tr></table></figure>
<p>Now press <code>\</code> and see what happens.</p>
<p>When you press <code>\</code> Vim ignores the <code>x</code> mapping and does whatever it would do for <code>x</code> by default.  Instead of deleting the current line, it deletes the current character.</p>
<p>Each of the <code>*map</code> commands has a <code>*noremap</code> counterpart that ignores other mappings: <code>noremap</code>, <code>nnoremap</code>, <code>vnoremap</code>, and <code>inoremap</code>.</p>
<p>When should you use these nonrecursive variants instead of their normal counterparts?</p>
<p><strong>Always.</strong></p>
<p><strong>No, seriously, <em>always</em>.</strong></p>
<p>Using a bare <code>*map</code> is just <em>asking</em> for pain down the road when you install a plugin or add a new custom mapping.  Save yourself the trouble and type the extra characters to make sure it never happens.</p>
<h2 id="Exercises">Exercises</h2><p>Convert all the mappings you added to your <code>~/.vimrc</code> file in the previous chapters to their nonrecursive counterparts.</p>
<p>Read <code>:help unmap</code>.</p>
<p><a href="04.html">« Previous</a><a style="float:right" href="06.html">Next »</a></p>

      
    </div>
    
  </div>
  
</article>


</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
	<div id="footer-info" class="inner">
	&copy; 2016 Yiming LU<br>
	Hosted on <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.
	</div>
  </div>
</footer>
    </div>
    
<script>
  var disqus_shortname = 'ymlu';
  
  var disqus_url = 'http://blog.seasonsroad.com/LearnVimScriptTheHardWay/05.html';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

  </div>
</body>
</html>
"use strict";(self.webpackChunkimg_gps=self.webpackChunkimg_gps||[]).push([[267],{40267:function(n,e,i){i.r(e),i.d(e,{IMGGPSPage:function(){return R}});var t,a,o,d,r,l,s,c,p,x,h,f,g,m,u,b,w=i(1413),v=i(30168),y=i(29439),k=i(47313),j=i(25974),Z=i(65964),P=i(49292),M=i(89320),N=i(9284),G=i.n(N),S=i(16031),D=i(7152),z=i(610),C=i(36519),I=i(46417),U=400,F=400,H=10,B=19;function R(){var n=(0,k.useState)([]),e=(0,y.Z)(n,2),i=e[0],d=e[1],r=(0,k.useState)(!1),l=(0,y.Z)(r,2),s=l[0],c=l[1],p=(0,k.useState)(void 0),x=(0,y.Z)(p,2),h=x[0],f=x[1],g=(0,k.useState)(H),m=(0,y.Z)(g,2),u=m[0],b=m[1],N=(0,k.useState)(!1),R=(0,y.Z)(N,2),V=R[0],Y=R[1],nn=(0,k.useState)(!1),en=(0,y.Z)(nn,2),tn=en[0],an=en[1],on=(0,k.useState)(!1),dn=(0,y.Z)(on,2),rn=dn[0],ln=dn[1],sn=(0,k.useState)(!1),cn=(0,y.Z)(sn,2),pn=cn[0],xn=cn[1],hn=(0,k.useState)(!1),fn=(0,y.Z)(hn,2),gn=fn[0],mn=fn[1],un=(0,k.useState)({height:window.innerHeight,width:window.innerWidth}),bn=(0,y.Z)(un,2),wn=bn[0],vn=bn[1],yn=(0,k.useState)({shown:!1}),kn=(0,y.Z)(yn,2),jn=kn[0],Zn=kn[1],Pn=i.length>0;(0,k.useEffect)((function(){var n=(0,S.debounce)((function(){vn({height:window.innerHeight,width:window.innerWidth})}),50);return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}})),(0,k.useEffect)((function(){f(void 0),b(H),an(!1),Y(!1),ln(!1),xn(!1),mn(!1)}),[i]),(0,k.useEffect)((function(){f(void 0),b(H)}),[V,tn,rn,pn,gn]),(0,k.useEffect)((function(){jn.shown}),[jn.shown,jn.fileInfo]);var Mn=j.ZP.div(t||(t=(0,v.Z)(["\n    position: absolute;\n    top: 13px;\n    right: 170px;\n    cursor: pointer;\n    background: #fff;\n    padding: 5px;\n    border: 2px dashed #da2;\n    border-radius: 5px;\n    height: 60px;\n    width: 60px;\n    ","\n\n    > img {\n      ","\n    }\n\n    &:hover {\n      background-color: #f0f0f0;\n\n      img {\n        opacity: 0.8;\n      }\n    }\n\n    @media only screen and (max-width: 768px) {\n      top: 170px;\n      right: 13px;\n    }\n  "])),s?"":"filter: saturate(0%);",s?"filter: brightness(0.9);":""),Nn=j.ZP.div(a||(a=(0,v.Z)(["\n    width: ","px;\n    height: ","px;\n    transition: width 1s linear;\n    display: inline-block;\n\n    @media only screen and (max-width: 768px) {\n      width: ","px;\n      height: ","px;\n    }\n  "])),Pn?wn.width-U:wn.width,wn.height,wn.width,Pn?wn.height>800?wn.height-F:wn.height/2:wn.height),Gn=j.ZP.div(o||(o=(0,v.Z)(["\n    width: ","px;\n    height: ","px;\n    transition: width 1s linear;\n    display: inline-block;\n    overflow-y: scroll;\n\n    @media only screen and (max-width: 768px) {\n      width: ","px;\n      height: ","px;\n      margin-top: -7px;\n    }\n  "])),Pn?U:0,wn.height,wn.width,Pn?wn.height>800?F:wn.height/2:wn.height),Sn=function(){return(0,I.jsx)(_,{onClick:function(){window.location="/"},children:(0,I.jsx)("img",{src:"/images/logo/SR-oneline.png",alt:"SeasonsRoad",width:"250px"})})},Dn=function(){return(0,I.jsx)(Mn,{onClick:function(){return c(!s)},children:(0,I.jsx)("img",{src:"https://webapi.amap.com/theme/v1.3/m2.png",alt:"Toggle Cluster",width:"47px"})})},zn=function(n){var e=n/1024,i=n/1024/1024,t=n/1024/1024/1024;return t>1?t.toFixed(3)+"GB":i>1?i.toFixed(3)+"MB":e.toFixed(3)+"KB"},Cn=function(n){Promise.all((0,S.map)((0,S.filter)(n,(function(n){return n.type.startsWith("image")})),(function(n){return new Promise((function(e,i){z.ZP.thumbnailUrl(n).then((function(t){z.ZP.parse(n,!0).then((function(i){var a=!i.longitude||!i.latitude,o=!(0,S.includes)(i.subject,"Best Moment"),d=n.name!=="IMG_".concat((0,D.ZP)(i.CreateDate,"yyyymmdd_HHMMss"),".JPG"),r=n.name!=="IMG_".concat((0,D.ZP)(i.DateTimeOriginal,"yyyymmdd_HHMMss"),".JPG"),l=n.name!=="IMG_".concat((0,D.ZP)(i.ModifyDate,"yyyymmdd_HHMMss"),".JPG"),s=i.MetadataDate,c=!s||""===s||n.name!=="IMG_".concat(s.substr(0,4)).concat(s.substr(5,2)).concat(s.substr(8,2),"_").concat(s.substr(11,2)).concat(s.substr(14,2)).concat(s.substr(17,2),".JPG"),p=d||r||l||c,x="WGS-84"===i.GPSMapDatum,h=!a&&x&&!o&&!p,f=a?[null,null]:x?C.Z.transform([i.longitude,i.latitude],C.Z.WGS84,C.Z.GCJ02):[i.longitude,i.latitude],g=(0,y.Z)(f,2),m=g[0],u=g[1];e({file:n,url:t,exif:(0,w.Z)((0,w.Z)({},i),{},{longitude:m,latitude:u}),flags:{noGPS:a,noBM:o,datesUnmatched:p,cDateUnmatched:d,oDateUnmatched:r,mDateUnmatched:l,mdDateUnmatched:c,readyBM:h,readyMarked:!1}})})).catch((function(n){return i(n)}))})).catch((function(n){return i(n)}))}))}))).then((function(n){return d(n)}))},In=function(){return(0,I.jsx)(E,{children:(0,I.jsx)(P.b,{className:"image-drop",handleChange:Cn,name:"file",types:["JPG","JPEG","PNG","GIF"],multiple:!0})})},Un=function(n){Zn({shown:!0,fileInfo:n,urlFull:URL.createObjectURL(n.file)})},Fn=function(){jn.urlFull&&URL.revokeObjectURL(jn.urlFull),Zn({shown:!1,fileInfo:void 0})},Hn=(0,S.filter)(i,(function(n){return(!V||n.flags.noGPS)&&(!tn||n.flags.noBM)&&(!rn||n.flags.datesUnmatched)&&(!pn||n.flags.readyBM)&&(!gn||n.flags.readyMarked)}));return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Z.ql,{children:(0,I.jsx)("title",{children:"IMG GPS"})}),(0,I.jsx)(Nn,{children:(0,I.jsxs)(M.D5,{amapkey:"47fdb61ac8fd64ab46910152af623c17",version:"1.4.15",zoomEnable:!0,rotateEnable:!1,dragEnable:!0,scrollWheel:!0,touchZoom:!0,expandZoomRange:!0,zooms:[3,20],viewMode:"3D",useAMapUI:!0,plugins:["Scale","MapType","ToolBar"],zoom:u,center:h,children:[(0,I.jsx)(Sn,{}),(0,I.jsx)(Dn,{}),(0,I.jsx)(In,{}),Pn&&(0,I.jsx)(M.sR,{events:{click:function(n,e){return Un(e.w.extData.fileInfo)}},markers:(0,S.map)((0,S.filter)(Hn,(function(n){return!n.flags.noGPS})),(function(n){return{position:{longitude:n.exif.longitude,latitude:n.exif.latitude},name:n.file.name,fileInfo:n}})),useCluster:s,render:function(n){return(0,I.jsxs)(X,{children:[(0,I.jsx)("div",{className:"marker-arrow"}),(0,I.jsx)("img",{className:"marker-img",src:n.fileInfo.url,alt:n.name})]})}})]})}),(0,I.jsxs)(Gn,{children:[Pn&&(0,I.jsxs)(T,{children:[(0,I.jsx)(W,{className:V?"checked":"",onClick:function(){return Y(!V)},children:"No GPS"}),(0,I.jsx)(W,{className:tn?"checked":"",onClick:function(){return an(!tn)},children:"No BM"}),(0,I.jsx)(W,{className:rn?"checked":"",onClick:function(){return ln(!rn)},children:"Unmatched Dates"}),(0,I.jsx)(W,{className:pn?"checked":"",onClick:function(){return xn(!pn)},children:"BM Ready"}),(0,I.jsx)(W,{className:gn?"checked":"",onClick:function(){return mn(!gn)},children:"Marked Ready"})]}),(0,S.map)(Hn,(function(n){var e=!!n.file.name.match(/^IMG_\d\d\d\d\d\d\d\d_\d\d\d\d\d\d((\+|-)\d\d\d\d)?.(JPG|PNG|GIF)$/);return(0,I.jsxs)(L,{children:[(0,I.jsx)(J,{src:n.url,alt:n.file.name,onClick:function(){return Un(n)}}),(0,I.jsxs)(O,{children:[n.flags.noBM||(0,I.jsx)("div",{className:"flag-bm",children:"BM"}),n.flags.noGPS||(0,I.jsx)("div",{className:"flag-gps",title:"click to navigate",onClick:function(){f([n.exif.longitude,n.exif.latitude]),b(B)},children:"GPS"}),(0,I.jsx)("div",{className:"image-name".concat(e?"":" red"),children:n.file.name}),(0,I.jsxs)("div",{className:"image-size-type",children:[(0,I.jsx)("div",{className:"image-size",children:zn(n.file.size)}),(0,I.jsx)("div",{className:"image-type",children:n.file.type})]}),(0,I.jsxs)("div",{className:"image-dates",children:[(0,I.jsxs)("div",{className:"image-cdate".concat(n.flags.cDateUnmatched?" red":""),children:[(0,I.jsx)("span",{children:"CDate:"})," ",(0,D.ZP)(n.exif.CreateDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,I.jsxs)("div",{className:"image-odate".concat(n.flags.oDateUnmatched?" red":""),children:[(0,I.jsx)("span",{children:"ODate:"})," ",(0,D.ZP)(n.exif.DateTimeOriginal,"yyyy-mm-dd HH:MM:ss o")]}),(0,I.jsxs)("div",{className:"image-mdate".concat(n.flags.mDateUnmatched?" red":""),children:[(0,I.jsx)("span",{children:"MDate:"})," ",(0,D.ZP)(n.exif.ModifyDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,I.jsxs)("div",{className:"image-mddate".concat(n.flags.mdDateUnmatched?" red":""),children:[(0,I.jsx)("span",{children:"MDDate:"})," ",n.exif.MetadataDate||"(empty)"]})]}),(0,I.jsx)("div",{className:"image-gps-area",children:n.flags.noGPS?(0,I.jsx)("div",{className:"image-gps red",children:"No GPS"}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"gps-goto",title:"click to navigate",onClick:function(){f([n.exif.longitude,n.exif.latitude]),b(B)},children:"\u2316"}),(0,I.jsx)("div",{className:"image-gps",title:"click to copy",onClick:function(){return navigator.clipboard.writeText("".concat(n.exif.longitude,",").concat(n.exif.latitude))},children:"".concat(n.exif.longitude.toFixed(6),",").concat(n.exif.latitude.toFixed(6))})]})})]})]})})),Pn&&(0,I.jsx)(q,{onClick:function(){d([]),(0,S.each)(Hn,(function(n){n.url&&URL.revokeObjectURL(n.url)}))},children:"X"})]}),(0,I.jsxs)(G(),{isOpen:jn.shown,contentLabel:"Image Details",onRequestClose:Fn,children:[jn.fileInfo&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(A,{children:(0,I.jsx)(K,{src:jn.urlFull,alt:jn.fileInfo.file.name})}),(0,I.jsxs)($,{children:[(0,I.jsx)("div",{className:"exif-title",children:"EXIF"}),(0,I.jsx)("div",{className:"exif-details",children:(0,S.map)(jn.fileInfo.exif,(function(n,e){var i="object"===typeof n?n.toLocaleString():n;return(0,I.jsxs)("div",{className:"exif-line",children:[(0,I.jsx)("span",{className:"exif-line-key",title:e,children:e}),(0,I.jsx)("span",{className:"exif-line-divider",children:":"}),(0,I.jsx)("span",{className:"exif-line-value",title:i.toString(),children:i})]},e)}))})]})]}),(0,I.jsx)(Q,{onClick:Fn,children:"X"})]})]})}var _=j.ZP.div(d||(d=(0,v.Z)(["\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  background: #fffb;\n  cursor: pointer;\n\n  @media only screen and (max-width: 768px) {\n    width: 200px;\n  }\n"]))),E=j.ZP.div(r||(r=(0,v.Z)(["\n  position: absolute;\n  top: 13px;\n  right: 90px;\n  background: #fff;\n\n  > label {\n    height: 60px;\n    width: 60px;\n    min-width: 60px;\n    padding: 8px 12px;\n\n    > input {\n      width: 10px;\n    }\n\n    > div {\n      display: none;\n    }\n  }\n\n  &:hover {\n    background-color: #f0f0f0;\n\n    label svg {\n      opacity: 0.8;\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    top: 90px;\n    right: 13px;\n  }\n"]))),L=j.ZP.div(l||(l=(0,v.Z)(["\n  width: ","px;\n  border: 1px solid #eee;\n  border-left: 2px solid #ccc;\n\n  @media only screen and (max-width: 768px) {\n    width: 50%;\n    display: inline-block;\n  }\n\n  @media only screen and (max-width: 730px) {\n    width: 100%;\n  }\n"])),U),J=j.ZP.img(s||(s=(0,v.Z)(["\n  width: 110px;\n  height: 110px;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n  cursor: pointer;\n\n  @media only screen and (max-width: 768px) {\n    width: 90px;\n    height: 90px;\n  }\n"]))),O=j.ZP.div(c||(c=(0,v.Z)(["\n  display: inline-block;\n  margin: 0 5px;\n  vertical-align: top;\n  width: calc(100% - 120px);\n  height: 110px;\n  line-height: 1;\n  position: relative;\n\n  div.flag-bm {\n    position: absolute;\n    top: 4px;\n    right: 0;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n  }\n\n  div.flag-gps {\n    position: absolute;\n    top: 4px;\n    right: 30px;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n    cursor: pointer;\n\n    &:hover {\n      background-color: #eee;\n    }\n  }\n\n  div.image-name {\n    font-size: 12px;\n    font-weight: 500;\n    margin-top: 4px;\n  }\n\n  div.image-size-type {\n    display: inline-block;\n    width: 100%;\n\n    div.image-size {\n      margin-left: 6px;\n      font-size: 10px;\n      display: inline-block;\n    }\n\n    div.image-type {\n      font-size: 8px;\n      display: inline-block;\n      margin-left: 10px;\n    }\n  }\n\n  div.image-dates {\n    margin: 4px 0 0 8px;\n    font-size: 8px;\n\n    div {\n      font-weight: 500;\n\n      > span {\n        font-weight: 400;\n        width: 50px;\n        display: inline-block;\n      }\n    }\n  }\n\n  div.image-gps-area {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n\n    div.image-gps {\n      font-size: 10px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        text-decoration: underline;\n      }\n    }\n\n    div.gps-goto {\n      font-size: 18px;\n      line-height: 20px;\n      margin-top: -2px;\n      padding: 0 5px 5px;\n      margin-right: 4px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        background-color: #eee;\n      }\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    width: calc(100% - 100px);\n    height: 90px;\n  }\n"]))),T=j.ZP.div(p||(p=(0,v.Z)(["\n  height: 26px;\n  margin-top: -2px;\n\n  @media only screen and (max-width: 768px) {\n    margin-top: 0;\n  }\n"]))),W=j.ZP.span(x||(x=(0,v.Z)(["\n  height: 24px;\n  padding: 6px 6px;\n  font-size: 10px;\n  font-weight: 500;\n  border: 1px solid #666;\n  background-color: #eee;\n  cursor: pointer;\n\n  &.checked {\n    background-color: #666;\n    color: #fff;\n  }\n\n  &:hover {\n    opacity: 0.8;\n  }\n"]))),X=j.ZP.div(h||(h=(0,v.Z)(["\n  width: 20px;\n  height: 35px;\n  display: inline-block;\n  position: relative;\n\n  img.marker-img {\n    width: 60px;\n    height: 60px;\n    object-fit: cover;\n    border: 2px solid #05f;\n    position: absolute;\n    top: -40px;\n    left: -20px;\n  }\n\n  div.marker-arrow {\n    width: 20px;\n    height: 20px;\n    background-color: #05f;\n    border-top: 5px solid #05f;\n    border-left: 5px solid #05f;\n    transform: rotate(225deg);\n    position: absolute;\n    bottom: 5px;\n    left: 0px;\n  }\n\n  &:hover {\n    img.marker-img {\n      border: 2px solid #9bf;\n    }\n\n    div.marker-arrow {\n      background-color: #9bf;\n      border-top: 5px solid #9bf;\n      border-left: 5px solid #9bf;\n    }\n  }\n"]))),q=j.ZP.div(f||(f=(0,v.Z)(["\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  padding: 14px 21px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 4px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n\n  @media only screen and (max-width: 768px) {\n    font-size: 14px;\n    padding: 8px 14px;\n    background-color: #eee;\n    border-radius: 30px;\n  }\n"]))),A=j.ZP.div(g||(g=(0,v.Z)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 400px;\n\n  @media only screen and (max-width: 768px) {\n    width: 100%;\n    bottom: auto;\n    height: 400px;\n    right: 0;\n  }\n\n  @media only screen and (max-width: 730px) {\n    height: 300px;\n  }\n"]))),K=j.ZP.img(m||(m=(0,v.Z)(["\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n\n  @media only screen and (max-width: 768px) {\n    border-right: none;\n    border-bottom: 1px solid #eee;\n  }\n"]))),$=j.ZP.div(u||(u=(0,v.Z)(["\n  position: absolute;\n  top: 0;\n  width: 400px;\n  bottom: 0;\n  right: 0;\n\n  .exif-title {\n    font-size: 20px;\n    line-height: 40px;\n    height: 40px;\n    padding-left: 10px;\n    border-bottom: 1px solid #eee;\n  }\n\n  .exif-details {\n    padding: 10px;\n    height: calc(100% - 40px);\n    overflow-y: scroll;\n\n    .exif-line {\n      .exif-line-key {\n        font-size: 10px;\n        display: inline-block;\n        width: 120px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-divider {\n        font-size: 10px;\n        display: inline-block;\n        width: 10px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-value {\n        font-size: 10px;\n        display: inline-block;\n        width: 250px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    top: 400px;\n    width: 100%;\n\n    .exif-details {\n      .exif-line {\n        .exif-line-value {\n          width: calc(100% - 150px);\n        }\n      }\n    }\n  }\n\n  @media only screen and (max-width: 730px) {\n    top: 300px;\n  }\n"]))),Q=j.ZP.div(b||(b=(0,v.Z)(["\n  position: absolute;\n  font-size: 10px;\n  top: 10px;\n  right: 10px;\n  padding: 2px 7px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 2px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n"])))}}]);
"use strict";(self.webpackChunkimg_gps=self.webpackChunkimg_gps||[]).push([[267],{40267:function(n,e,i){i.r(e),i.d(e,{IMGGPSPage:function(){return H}});var t,o,a,s,r,l,d,c,p,x,h,f,u,g,m,v,b,w=i(1413),j=i(30168),k=i(29439),y=i(47313),Z=i(25974),P=i(65964),M=i(49292),N=i(89320),G=i(9284),S=i.n(G),D=i(16031),z=i(7152),C=i(610),I=i(36519),U=i(46417),F=360;function H(){var n=(0,y.useState)([]),e=(0,k.Z)(n,2),i=e[0],s=e[1],r=(0,y.useState)(!1),l=(0,k.Z)(r,2),d=l[0],c=l[1],p=(0,y.useState)(void 0),x=(0,k.Z)(p,2),h=x[0],f=x[1],u=(0,y.useState)(10),g=(0,k.Z)(u,2),m=g[0],v=g[1],b=(0,y.useState)(!1),G=(0,k.Z)(b,2),H=G[0],V=G[1],Y=(0,y.useState)(!1),$=(0,k.Z)(Y,2),nn=$[0],en=$[1],tn=(0,y.useState)(!1),on=(0,k.Z)(tn,2),an=on[0],sn=on[1],rn=(0,y.useState)(!1),ln=(0,k.Z)(rn,2),dn=ln[0],cn=ln[1],pn=(0,y.useState)(!1),xn=(0,k.Z)(pn,2),hn=xn[0],fn=xn[1],un=(0,y.useState)({height:window.innerHeight,width:window.innerWidth}),gn=(0,k.Z)(un,2),mn=gn[0],vn=gn[1],bn=(0,y.useState)({shown:!1}),wn=(0,k.Z)(bn,2),jn=wn[0],kn=wn[1],yn=i.length>0;(0,y.useEffect)((function(){var n=(0,D.debounce)((function(){vn({height:window.innerHeight,width:window.innerWidth})}),50);return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}})),(0,y.useEffect)((function(){f(void 0),v(10),en(!1),V(!1),sn(!1),cn(!1),fn(!1)}),[i]),(0,y.useEffect)((function(){f(void 0),v(10)}),[H,nn,an,dn,hn]),(0,y.useEffect)((function(){jn.shown}),[jn.shown,jn.fileInfo]);var Zn=Z.ZP.div(t||(t=(0,j.Z)(["\n    position: absolute;\n    top: 13px;\n    right: 170px;\n    cursor: pointer;\n    background: #fff;\n    padding: 5px;\n    border: 2px dashed #da2;\n    border-radius: 5px;\n    height: 60px;\n    width: 60px;\n    ","\n\n    > img {\n      ","\n    }\n\n    &:hover {\n      background-color: #f0f0f0;\n\n      img {\n        opacity: 0.8;\n      }\n    }\n  "])),d?"":"filter: saturate(0%);",d?"filter: brightness(0.9);":""),Pn=Z.ZP.div(o||(o=(0,j.Z)(["\n    width: ","px;\n    height: ","px;\n    transition: width 1s linear;\n    display: inline-block;\n  "])),yn?mn.width-F:mn.width,mn.height),Mn=Z.ZP.div(a||(a=(0,j.Z)(["\n    width: ","px;\n    height: ","px;\n    transition: width 1s linear;\n    display: inline-block;\n    overflow-y: scroll;\n  "])),yn?F:0,mn.height),Nn=function(){return(0,U.jsx)(B,{children:(0,U.jsx)("img",{src:"/images/logo/SR-oneline.png",alt:"SeasonsRoad",width:"250px"})})},Gn=function(){return(0,U.jsx)(Zn,{onClick:function(){return c(!d)},children:(0,U.jsx)("img",{src:"https://webapi.amap.com/theme/v1.3/m2.png",alt:"Toggle Cluster",width:"47px"})})},Sn=function(n){var e=n/1024,i=n/1024/1024,t=n/1024/1024/1024;return t>1?t.toFixed(3)+"GB":i>1?i.toFixed(3)+"MB":e.toFixed(3)+"KB"},Dn=function(n){Promise.all((0,D.map)((0,D.filter)(n,(function(n){return n.type.startsWith("image")})),(function(n){return new Promise((function(e,i){C.ZP.thumbnailUrl(n).then((function(t){C.ZP.parse(n,!0).then((function(i){var o=!i.longitude||!i.latitude,a=!(0,D.includes)(i.subject,"Best Moment"),s=n.name!=="IMG_".concat((0,z.ZP)(i.CreateDate,"yyyymmdd_HHMMss"),".JPG"),r=n.name!=="IMG_".concat((0,z.ZP)(i.DateTimeOriginal,"yyyymmdd_HHMMss"),".JPG"),l=n.name!=="IMG_".concat((0,z.ZP)(i.ModifyDate,"yyyymmdd_HHMMss"),".JPG"),d=i.MetadataDate,c=!d||""===d||n.name!=="IMG_".concat(d.substr(0,4)).concat(d.substr(5,2)).concat(d.substr(8,2),"_").concat(d.substr(11,2)).concat(d.substr(14,2)).concat(d.substr(17,2),".JPG"),p=s||r||l||c,x="WGS-84"===i.GPSMapDatum,h=!o&&x&&!a&&!p,f=o?[null,null]:x?I.Z.transform([i.longitude,i.latitude],I.Z.WGS84,I.Z.GCJ02):[i.longitude,i.latitude],u=(0,k.Z)(f,2),g=u[0],m=u[1];e({file:n,url:t,exif:(0,w.Z)((0,w.Z)({},i),{},{longitude:g,latitude:m}),flags:{noGPS:o,noBM:a,datesUnmatched:p,cDateUnmatched:s,oDateUnmatched:r,mDateUnmatched:l,mdDateUnmatched:c,readyBM:h,readyMarked:!1}})})).catch((function(n){return i(n)}))})).catch((function(n){return i(n)}))}))}))).then((function(n){return s(n)}))},zn=function(){return(0,U.jsx)(R,{children:(0,U.jsx)(M.b,{className:"image-drop",handleChange:Dn,name:"file",types:["JPG","JPEG","PNG","GIF"],multiple:!0})})},Cn=function(n){kn({shown:!0,fileInfo:n,urlFull:URL.createObjectURL(n.file)})},In=function(){jn.urlFull&&URL.revokeObjectURL(jn.urlFull),kn({shown:!1,fileInfo:void 0})},Un=(0,D.filter)(i,(function(n){return(!H||n.flags.noGPS)&&(!nn||n.flags.noBM)&&(!an||n.flags.datesUnmatched)&&(!dn||n.flags.readyBM)&&(!hn||n.flags.readyMarked)}));return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(P.ql,{children:(0,U.jsx)("title",{children:"IMG GPS"})}),(0,U.jsx)(Pn,{children:(0,U.jsxs)(N.D5,{amapkey:"47fdb61ac8fd64ab46910152af623c17",version:"1.4.15",zoomEnable:!0,rotateEnable:!1,scrollWheel:!0,touchZoom:!0,viewMode:"3D",useAMapUI:!0,plugins:["Scale","MapType","ToolBar"],zoom:m,center:h,children:[(0,U.jsx)(Nn,{}),(0,U.jsx)(Gn,{}),(0,U.jsx)(zn,{}),yn&&(0,U.jsx)(N.sR,{events:{click:function(n,e){return Cn(e.w.extData.fileInfo)}},markers:(0,D.map)((0,D.filter)(Un,(function(n){return!n.flags.noGPS})),(function(n){return{position:{longitude:n.exif.longitude,latitude:n.exif.latitude},name:n.file.name,fileInfo:n}})),useCluster:d,render:function(n){return(0,U.jsxs)(W,{children:[(0,U.jsx)("div",{className:"marker-arrow"}),(0,U.jsx)("img",{className:"marker-img",src:n.fileInfo.url,alt:n.name})]})}})]})}),(0,U.jsxs)(Mn,{children:[yn&&(0,U.jsxs)(J,{children:[(0,U.jsx)(O,{className:H?"checked":"",onClick:function(){return V(!H)},children:"No GPS"}),(0,U.jsx)(O,{className:nn?"checked":"",onClick:function(){return en(!nn)},children:"No BM"}),(0,U.jsx)(O,{className:an?"checked":"",onClick:function(){return sn(!an)},children:"Unmatched Dates"}),(0,U.jsx)(O,{className:dn?"checked":"",onClick:function(){return cn(!dn)},children:"BM Ready"}),(0,U.jsx)(O,{className:hn?"checked":"",onClick:function(){return fn(!hn)},children:"Marked Ready"})]}),(0,U.jsx)(T,{}),(0,D.map)(Un,(function(n){return(0,U.jsxs)(E,{children:[(0,U.jsx)(L,{src:n.url,alt:n.file.name,onClick:function(){return Cn(n)}}),(0,U.jsxs)(_,{children:[n.flags.noBM||(0,U.jsx)("div",{className:"flag-bm",children:"BM"}),n.flags.noGPS||(0,U.jsx)("div",{className:"flag-gps",title:"click to navigate",onClick:function(){f([n.exif.longitude,n.exif.latitude]),v(18)},children:"GPS"}),(0,U.jsx)("div",{className:"image-name",children:n.file.name}),(0,U.jsxs)("div",{className:"image-size-type",children:[(0,U.jsx)("div",{className:"image-size",children:Sn(n.file.size)}),(0,U.jsx)("div",{className:"image-type",children:n.file.type})]}),(0,U.jsxs)("div",{className:"image-dates",children:[(0,U.jsxs)("div",{className:"image-cdate".concat(n.flags.cDateUnmatched?" red":""),children:[(0,U.jsx)("span",{children:"CDate:"})," ",(0,z.ZP)(n.exif.CreateDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,U.jsxs)("div",{className:"image-odate".concat(n.flags.oDateUnmatched?" red":""),children:[(0,U.jsx)("span",{children:"ODate:"})," ",(0,z.ZP)(n.exif.DateTimeOriginal,"yyyy-mm-dd HH:MM:ss o")]}),(0,U.jsxs)("div",{className:"image-mdate".concat(n.flags.mDateUnmatched?" red":""),children:[(0,U.jsx)("span",{children:"MDate:"})," ",(0,z.ZP)(n.exif.ModifyDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,U.jsxs)("div",{className:"image-mddate".concat(n.flags.mdDateUnmatched?" red":""),children:[(0,U.jsx)("span",{children:"MDDate:"})," ",n.exif.MetadataDate||"(empty)"]})]}),(0,U.jsx)("div",{className:"image-gps-area",children:n.flags.noGPS?(0,U.jsx)("div",{className:"image-gps red",children:"No GPS"}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"gps-goto",title:"click to navigate",onClick:function(){f([n.exif.longitude,n.exif.latitude]),v(18)},children:"\u2316"}),(0,U.jsx)("div",{className:"image-gps",title:"click to copy",onClick:function(){return navigator.clipboard.writeText("".concat(n.exif.longitude,",").concat(n.exif.latitude))},children:"".concat(n.exif.longitude.toFixed(6),",").concat(n.exif.latitude.toFixed(6))})]})})]})]})})),yn&&(0,U.jsx)(X,{onClick:function(){s([]),(0,D.each)(Un,(function(n){n.url&&URL.revokeObjectURL(n.url)}))},children:"X"})]}),(0,U.jsxs)(S(),{isOpen:jn.shown,contentLabel:"Image Details",onRequestClose:In,children:[jn.fileInfo&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(q,{children:(0,U.jsx)(A,{src:jn.urlFull,alt:jn.fileInfo.file.name})}),(0,U.jsxs)(K,{children:[(0,U.jsx)("div",{className:"exif-title",children:"EXIF"}),(0,U.jsx)("div",{className:"exif-details",children:(0,D.map)(jn.fileInfo.exif,(function(n,e){var i="object"===typeof n?n.toLocaleString():n;return(0,U.jsxs)("div",{className:"exif-line",children:[(0,U.jsx)("span",{className:"exif-line-key",title:e,children:e}),(0,U.jsx)("span",{className:"exif-line-divider",children:":"}),(0,U.jsx)("span",{className:"exif-line-value",title:i.toString(),children:i})]},e)}))})]})]}),(0,U.jsx)(Q,{onClick:In,children:"X"})]})]})}var B=Z.ZP.div(s||(s=(0,j.Z)(["\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  background: #fffb;\n"]))),R=Z.ZP.div(r||(r=(0,j.Z)(["\n  position: absolute;\n  top: 13px;\n  right: 90px;\n  background: #fff;\n\n  > label {\n    height: 60px;\n    width: 60px;\n    min-width: 60px;\n    padding: 8px 12px;\n\n    > input {\n      width: 10px;\n    }\n\n    > div {\n      display: none;\n    }\n  }\n\n  &:hover {\n    background-color: #f0f0f0;\n\n    label svg {\n      opacity: 0.8;\n    }\n  }\n"]))),E=Z.ZP.div(l||(l=(0,j.Z)(["\n  width: ","px;\n  border: 1px solid #eee;\n  border-left: 2px solid #ccc;\n"])),F),L=Z.ZP.img(d||(d=(0,j.Z)(["\n  width: 100px;\n  height: 100px;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n  cursor: pointer;\n"]))),_=Z.ZP.div(c||(c=(0,j.Z)(["\n  display: inline-block;\n  margin: 0 5px;\n  vertical-align: top;\n  width: calc(100% - 110px);\n  height: 100px;\n  line-height: 1;\n  position: relative;\n\n  div.flag-bm {\n    position: absolute;\n    top: 4px;\n    right: 0;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n  }\n\n  div.flag-gps {\n    position: absolute;\n    top: 4px;\n    right: 30px;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n    cursor: pointer;\n\n    &:hover {\n      background-color: #eee;\n    }\n  }\n\n  div.image-name {\n    font-size: 12px;\n    font-weight: 500;\n    margin-top: 4px;\n  }\n\n  div.image-size-type {\n    display: inline-block;\n    width: 100%;\n\n    div.image-size {\n      margin-left: 6px;\n      font-size: 10px;\n      display: inline-block;\n    }\n\n    div.image-type {\n      font-size: 8px;\n      display: inline-block;\n      margin-left: 10px;\n    }\n  }\n\n  div.image-dates {\n    margin: 4px 0 0 8px;\n    font-size: 8px;\n\n    div {\n      font-weight: 500;\n\n      > span {\n        font-weight: 400;\n        width: 40px;\n        display: inline-block;\n      }\n    }\n  }\n\n  div.image-gps-area {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 4px;\n\n    div.image-gps {\n      font-size: 10px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        text-decoration: underline;\n      }\n    }\n\n    div.gps-goto {\n      font-size: 18px;\n      line-height: 20px;\n      margin-top: -2px;\n      padding: 0 5px 5px;\n      margin-right: 4px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        background-color: #eee;\n      }\n    }\n  }\n"]))),J=Z.ZP.div(p||(p=(0,j.Z)(["\n  height: 24px;\n  position: absolute;\n  top: -2px;\n  right: 0;\n  width: ","px;\n"])),F),O=Z.ZP.span(x||(x=(0,j.Z)(["\n  height: 24px;\n  padding: 6px 8px;\n  font-size: 10px;\n  font-weight: 500;\n  border: 1px solid #666;\n  background-color: #eee;\n  cursor: pointer;\n\n  &.checked {\n    background-color: #666;\n    color: #fff;\n  }\n\n  &:hover {\n    opacity: 0.8;\n  }\n"]))),T=Z.ZP.div(h||(h=(0,j.Z)(["\n  height: 24px;\n"]))),W=Z.ZP.div(f||(f=(0,j.Z)(["\n  width: 20px;\n  height: 35px;\n  display: inline-block;\n  position: relative;\n\n  img.marker-img {\n    width: 60px;\n    height: 60px;\n    object-fit: cover;\n    border: 2px solid #05f;\n    position: absolute;\n    top: -40px;\n    left: -20px;\n  }\n\n  div.marker-arrow {\n    width: 20px;\n    height: 20px;\n    background-color: #05f;\n    border-top: 5px solid #05f;\n    border-left: 5px solid #05f;\n    transform: rotate(225deg);\n    position: absolute;\n    bottom: 5px;\n    left: 0px;\n  }\n\n  &:hover {\n    img.marker-img {\n      border: 2px solid #9bf;\n    }\n\n    div.marker-arrow {\n      background-color: #9bf;\n      border-top: 5px solid #9bf;\n      border-left: 5px solid #9bf;\n    }\n  }\n"]))),X=Z.ZP.div(u||(u=(0,j.Z)(["\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  padding: 14px 21px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 4px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n"]))),q=Z.ZP.div(g||(g=(0,j.Z)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 400px;\n"]))),A=Z.ZP.img(m||(m=(0,j.Z)(["\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n"]))),K=Z.ZP.div(v||(v=(0,j.Z)(["\n  position: absolute;\n  top: 0;\n  width: 400px;\n  bottom: 0;\n  right: 0;\n\n  .exif-title {\n    font-size: 20px;\n    line-height: 40px;\n    height: 40px;\n    padding-left: 10px;\n    border-bottom: 1px solid #eee;\n  }\n\n  .exif-details {\n    padding: 10px;\n    height: calc(100% - 40px);\n    overflow-y: scroll;\n\n    .exif-line {\n      .exif-line-key {\n        font-size: 10px;\n        display: inline-block;\n        width: 120px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-divider {\n        font-size: 10px;\n        display: inline-block;\n        width: 10px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-value {\n        font-size: 10px;\n        display: inline-block;\n        width: 250px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n    }\n  }\n"]))),Q=Z.ZP.div(b||(b=(0,j.Z)(["\n  position: absolute;\n  font-size: 10px;\n  top: 10px;\n  right: 10px;\n  padding: 2px 7px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 2px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n"])))}}]);
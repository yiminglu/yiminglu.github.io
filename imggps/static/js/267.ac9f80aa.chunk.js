"use strict";(self.webpackChunkimg_gps=self.webpackChunkimg_gps||[]).push([[267],{40267:function(n,e,i){i.r(e),i.d(e,{IMGGPSPage:function(){return H}});var t,o,a,s,d,r,l,c,p,h,x,f,m,u,g,w,b=i(30168),v=i(1413),y=i(29439),j=i(47313),k=i(25974),Z=i(65964),P=i(49292),M=i(89320),G=i(9284),N=i.n(G),D=i(16031),S=i(7152),z=i(610),C=i(36519),F=i(46417),I=10,U=19;function H(){var n=(0,j.useState)([]),e=(0,y.Z)(n,2),i=e[0],t=e[1],o=(0,j.useState)(!1),a=(0,y.Z)(o,2),s=a[0],d=a[1],r=(0,j.useState)(void 0),l=(0,y.Z)(r,2),c=l[0],p=l[1],h=(0,j.useState)(I),x=(0,y.Z)(h,2),f=x[0],m=x[1],u=(0,j.useState)(!1),g=(0,y.Z)(u,2),w=g[0],b=g[1],k=(0,j.useState)(!1),G=(0,y.Z)(k,2),H=G[0],Y=G[1],nn=(0,j.useState)(!1),en=(0,y.Z)(nn,2),tn=en[0],on=en[1],an=(0,j.useState)(!1),sn=(0,y.Z)(an,2),dn=sn[0],rn=sn[1],ln=(0,j.useState)({height:window.innerHeight,width:window.innerWidth}),cn=(0,y.Z)(ln,2),pn=cn[0],hn=cn[1],xn=(0,j.useState)({shown:!1}),fn=(0,y.Z)(xn,2),mn=fn[0],un=fn[1],gn=i.length>0;(0,j.useEffect)((function(){var n=(0,D.debounce)((function(){hn({height:window.innerHeight,width:window.innerWidth})}),50);return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}})),(0,j.useEffect)((function(){p(void 0),m(I),Y(!1),b(!1),on(!1),rn(!1)}),[i]),(0,j.useEffect)((function(){p(void 0),m(I)}),[w,H,tn,dn]),(0,j.useEffect)((function(){mn.shown}),[mn.shown,mn.fileInfo]);var wn=function(){return(0,F.jsx)(B,{onClick:function(){window.location="/"},children:(0,F.jsx)("img",{src:"/images/logo/SR-oneline.png",alt:"SeasonsRoad",width:"250px"})})},bn=function(){return(0,F.jsx)(_,{cluster:s,onClick:function(){return d(!s)},children:(0,F.jsx)("img",{src:"https://webapi.amap.com/theme/v1.3/m2.png",alt:"Toggle Cluster",width:"47px"})})},vn=function(n){var e=n/1024,i=n/1024/1024,t=n/1024/1024/1024;return t>1?t.toFixed(3)+"GB":i>1?i.toFixed(3)+"MB":e.toFixed(3)+"KB"},yn=function(n){Promise.all((0,D.map)((0,D.filter)(n,(function(n){return n.type.startsWith("image")})),(function(n){return new Promise((function(e,i){z.ZP.thumbnailUrl(n).then((function(t){z.ZP.parse(n,!0).then((function(i){var o=!i.longitude||!i.latitude,a=!(0,D.includes)(i.subject,"Best Moment"),s=n.name!=="IMG_".concat((0,S.ZP)(i.CreateDate,"yyyymmdd_HHMMss"),".JPG"),d=n.name!=="IMG_".concat((0,S.ZP)(i.DateTimeOriginal,"yyyymmdd_HHMMss"),".JPG"),r=n.name!=="IMG_".concat((0,S.ZP)(i.ModifyDate,"yyyymmdd_HHMMss"),".JPG"),l=i.MetadataDate,c=!l||""===l,p=c||n.name!=="IMG_".concat(l.substr(0,4)).concat(l.substr(5,2)).concat(l.substr(8,2),"_").concat(l.substr(11,2)).concat(l.substr(14,2)).concat(l.substr(17,2),".JPG"),h=s||d||r||!c&&p,x="WGS-84"===i.GPSMapDatum,f=!o&&x&&!a&&!h,m=o?[null,null]:x?C.Z.transform([i.longitude,i.latitude],C.Z.WGS84,C.Z.GCJ02):[i.longitude,i.latitude],u=(0,y.Z)(m,2),g=u[0],w=u[1];e({file:n,url:t,exif:(0,v.Z)((0,v.Z)({},i),{},{longitude:g,latitude:w}),flags:{noGPS:o,noBM:a,datesUnmatched:h,cDateUnmatched:s,oDateUnmatched:d,mDateUnmatched:r,mdDateEmpty:c,mdDateUnmatched:p,readyBM:f,readyMarked:!1}})})).catch((function(n){return i(n)}))})).catch((function(n){return i(n)}))}))}))).then((function(n){return t(n)}))},jn=function(){return(0,F.jsx)(E,{children:(0,F.jsx)(P.b,{className:"image-drop",handleChange:yn,name:"file",types:["JPG","JPEG","PNG","GIF"],multiple:!0})})},kn=function(n){un({shown:!0,fileInfo:n,urlFull:URL.createObjectURL(n.file)})},Zn=function(){mn.urlFull&&URL.revokeObjectURL(mn.urlFull),un({shown:!1,fileInfo:void 0})},Pn=(0,j.useMemo)((function(){return(0,D.filter)(i,(function(n){return(!w||n.flags.noGPS)&&(!H||n.flags.noBM)&&(!tn||n.flags.datesUnmatched)&&(!dn||!n.flags.readyBM)}))}),[i,tn,H,w,dn]),Mn=(0,j.useMemo)((function(){return(0,D.map)(Pn,(function(n){var e=!!n.file.name.match(/^IMG_\d\d\d\d\d\d\d\d_\d\d\d\d\d\d((\+|-)\d\d\d\d)?.(JPG|PNG|GIF)$/);return(0,F.jsxs)(J,{children:[(0,F.jsx)(O,{src:n.url,alt:n.file.name,onClick:function(){return kn(n)}}),(0,F.jsxs)(T,{children:[n.flags.noBM||(0,F.jsx)("div",{className:"flag-bm",children:"BM"}),n.flags.noGPS||(0,F.jsx)("div",{className:"flag-gps",title:"click to navigate",onClick:function(){p([n.exif.longitude,n.exif.latitude]),m(U)},children:"GPS"}),(0,F.jsx)("div",{className:"image-name".concat(e?"":" red"),children:n.file.name}),(0,F.jsxs)("div",{className:"image-size-type",children:[(0,F.jsx)("div",{className:"image-size",children:vn(n.file.size)}),(0,F.jsx)("div",{className:"image-type",children:n.file.type})]}),(0,F.jsxs)("div",{className:"image-dates",children:[(0,F.jsxs)("div",{className:"image-cdate".concat(n.flags.cDateUnmatched?" red":""),children:[(0,F.jsx)("span",{children:"CDate:"})," ",(0,S.ZP)(n.exif.CreateDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,F.jsxs)("div",{className:"image-odate".concat(n.flags.oDateUnmatched?" red":""),children:[(0,F.jsx)("span",{children:"ODate:"})," ",(0,S.ZP)(n.exif.DateTimeOriginal,"yyyy-mm-dd HH:MM:ss o")]}),(0,F.jsxs)("div",{className:"image-mdate".concat(n.flags.mDateUnmatched?" red":""),children:[(0,F.jsx)("span",{children:"MDate:"})," ",(0,S.ZP)(n.exif.ModifyDate,"yyyy-mm-dd HH:MM:ss o")]}),(0,F.jsxs)("div",{className:"image-mddate".concat(n.flags.mdDateEmpty?" yellow":n.flags.mdDateUnmatched?" red":""),children:[(0,F.jsx)("span",{children:"MDDate:"})," ",n.exif.MetadataDate||"(empty)"]})]}),(0,F.jsx)("div",{className:"image-gps-area",children:n.flags.noGPS?(0,F.jsx)("div",{className:"image-gps red",children:"No GPS"}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"gps-goto",title:"click to navigate",onClick:function(){p([n.exif.longitude,n.exif.latitude]),m(U)},children:"\u2316"}),(0,F.jsx)("div",{className:"image-gps",title:"click to copy",onClick:function(){return navigator.clipboard.writeText("".concat(n.exif.longitude,",").concat(n.exif.latitude))},children:"".concat(n.exif.longitude.toFixed(6),",").concat(n.exif.latitude.toFixed(6))})]})})]})]})}))}),[Pn]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Z.ql,{children:(0,F.jsx)("title",{children:"IMG GPS"})}),(0,F.jsx)(R,{showFiles:gn,dimensions:pn,children:(0,F.jsxs)(M.D5,{amapkey:"47fdb61ac8fd64ab46910152af623c17",version:"1.4.15",zoomEnable:!0,rotateEnable:!1,dragEnable:!0,scrollWheel:!0,touchZoom:!0,expandZoomRange:!0,zooms:[3,20],viewMode:"3D",useAMapUI:!0,plugins:["Scale","MapType","ToolBar"],zoom:f,center:c,children:[(0,F.jsx)(wn,{}),(0,F.jsx)(bn,{}),(0,F.jsx)(jn,{}),gn&&(0,F.jsx)(M.sR,{events:{click:function(n,e){return kn(e.w.extData.fileInfo)}},markers:(0,D.map)((0,D.filter)(Pn,(function(n){return!n.flags.noGPS})),(function(n){return{position:{longitude:n.exif.longitude,latitude:n.exif.latitude},name:n.file.name,fileInfo:n}})),useCluster:s,render:function(n){return(0,F.jsxs)(q,{children:[(0,F.jsx)("div",{className:"marker-arrow"}),(0,F.jsx)("img",{className:"marker-img",src:n.fileInfo.url,alt:n.name})]})}})]})}),(0,F.jsxs)(L,{showFiles:gn,dimensions:pn,children:[gn&&(0,F.jsxs)(W,{children:[(0,F.jsx)(X,{className:w?"checked":"",onClick:function(){return b(!w)},children:"No GPS"}),(0,F.jsx)(X,{className:H?"checked":"",onClick:function(){return Y(!H)},children:"No BM"}),(0,F.jsx)(X,{className:tn?"checked":"",onClick:function(){return on(!tn)},children:"Unmatched Dates"}),(0,F.jsx)(X,{className:dn?"checked":"",onClick:function(){return rn(!dn)},children:"BM Unready"})]}),Mn,gn&&(0,F.jsx)(A,{onClick:function(){t([]),(0,D.each)(Pn,(function(n){n.url&&URL.revokeObjectURL(n.url)}))},children:"X"})]}),(0,F.jsxs)(N(),{isOpen:mn.shown,contentLabel:"Image Details",onRequestClose:Zn,children:[mn.fileInfo&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(K,{children:(0,F.jsx)($,{src:mn.urlFull,alt:mn.fileInfo.file.name})}),(0,F.jsxs)(Q,{children:[(0,F.jsx)("div",{className:"exif-title",children:"EXIF"}),(0,F.jsx)("div",{className:"exif-details",children:(0,D.map)(mn.fileInfo.exif,(function(n,e){var i="object"===typeof n?n.toLocaleString():n;return(0,F.jsxs)("div",{className:"exif-line",children:[(0,F.jsx)("span",{className:"exif-line-key",title:e,children:e}),(0,F.jsx)("span",{className:"exif-line-divider",children:":"}),(0,F.jsx)("span",{className:"exif-line-value",title:i.toString(),children:i})]},e)}))})]})]}),(0,F.jsx)(V,{onClick:Zn,children:"X"})]})]})}var B=k.ZP.div(t||(t=(0,b.Z)(["\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  background: #fffb;\n  cursor: pointer;\n\n  @media only screen and (max-width: 768px) {\n    width: 200px;\n  }\n"]))),E=k.ZP.div(o||(o=(0,b.Z)(["\n  position: absolute;\n  top: 13px;\n  right: 90px;\n  background: #fff;\n\n  > label {\n    height: 60px;\n    width: 60px;\n    min-width: 60px;\n    padding: 8px 12px;\n\n    > input {\n      width: 10px;\n    }\n\n    > div {\n      display: none;\n    }\n  }\n\n  &:hover {\n    background-color: #f0f0f0;\n\n    label svg {\n      opacity: 0.8;\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    top: 90px;\n    right: 13px;\n  }\n"]))),_=k.ZP.div(a||(a=(0,b.Z)(["\n  position: absolute;\n  top: 13px;\n  right: 170px;\n  cursor: pointer;\n  background: #fff;\n  padding: 5px;\n  border: 2px dashed #da2;\n  border-radius: 5px;\n  height: 60px;\n  width: 60px;\n  ","\n\n  > img {\n    ","\n  }\n\n  &:hover {\n    background-color: #f0f0f0;\n\n    img {\n      opacity: 0.8;\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    top: 170px;\n    right: 13px;\n  }\n"])),(function(n){return n.cluster?"":"filter: saturate(0%);"}),(function(n){return n.cluster?"filter: brightness(0.9);":""})),R=k.ZP.div(s||(s=(0,b.Z)(["\n  width: ","px;\n  height: ","px;\n  transition: width 0.2s linear;\n  transition: height 0.2s linear;\n  display: inline-block;\n\n  @media only screen and (max-width: 768px) {\n    width: ","px;\n    height: ","px;\n  }\n"])),(function(n){return n.showFiles?n.dimensions.width-400:n.dimensions.width}),(function(n){return n.dimensions.height}),(function(n){return n.dimensions.width}),(function(n){return n.showFiles?n.dimensions.height>800?n.dimensions.height-400:n.dimensions.height/2:n.dimensions.height})),L=k.ZP.div(d||(d=(0,b.Z)(["\n  width: ","px;\n  height: ","px;\n  transition: width 0.2s linear;\n  transition: height 0.2s linear;\n  display: inline-block;\n  overflow-y: scroll;\n\n  @media only screen and (max-width: 768px) {\n    width: ","px;\n    height: ","px;\n    margin-top: -7px;\n  }\n"])),(function(n){return n.showFiles?400:0}),(function(n){return n.dimensions.height}),(function(n){return n.dimensions.width}),(function(n){return n.showFiles?n.dimensions.height>800?400:n.dimensions.height/2:n.dimensions.height})),J=k.ZP.div(r||(r=(0,b.Z)(["\n  width: ","px;\n  border: 1px solid #eee;\n  border-left: 2px solid #ccc;\n\n  @media only screen and (max-width: 768px) {\n    width: 50%;\n    display: inline-block;\n  }\n\n  @media only screen and (max-width: 730px) {\n    width: 100%;\n  }\n"])),400),O=k.ZP.img(l||(l=(0,b.Z)(["\n  width: 110px;\n  height: 110px;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n  cursor: pointer;\n\n  @media only screen and (max-width: 768px) {\n    width: 90px;\n    height: 90px;\n  }\n"]))),T=k.ZP.div(c||(c=(0,b.Z)(["\n  display: inline-block;\n  margin: 0 5px;\n  vertical-align: top;\n  width: calc(100% - 120px);\n  height: 110px;\n  line-height: 1;\n  position: relative;\n\n  div.flag-bm {\n    position: absolute;\n    top: 4px;\n    right: 0;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n  }\n\n  div.flag-gps {\n    position: absolute;\n    top: 4px;\n    right: 30px;\n    font-size: 8px;\n    line-height: 6px;\n    font-weight: 600;\n    color: #0a0;\n    padding: 2px 4px;\n    border: 1px dashed #0a0;\n    cursor: pointer;\n\n    &:hover {\n      background-color: #eee;\n    }\n  }\n\n  div.image-name {\n    font-size: 12px;\n    font-weight: 500;\n    margin-top: 4px;\n  }\n\n  div.image-size-type {\n    display: inline-block;\n    width: 100%;\n\n    div.image-size {\n      margin-left: 6px;\n      font-size: 10px;\n      display: inline-block;\n    }\n\n    div.image-type {\n      font-size: 8px;\n      display: inline-block;\n      margin-left: 10px;\n    }\n  }\n\n  div.image-dates {\n    margin: 4px 0 0 8px;\n    font-size: 8px;\n\n    div {\n      font-weight: 500;\n\n      > span {\n        font-weight: 400;\n        width: 50px;\n        display: inline-block;\n      }\n    }\n  }\n\n  div.image-gps-area {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n\n    div.image-gps {\n      font-size: 10px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        text-decoration: underline;\n      }\n    }\n\n    div.gps-goto {\n      font-size: 18px;\n      line-height: 20px;\n      margin-top: -2px;\n      padding: 0 5px 5px;\n      margin-right: 4px;\n      cursor: pointer;\n      display: inline-block;\n\n      &:hover {\n        background-color: #eee;\n      }\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    width: calc(100% - 100px);\n    height: 90px;\n  }\n"]))),W=k.ZP.div(p||(p=(0,b.Z)(["\n  height: 26px;\n  margin-top: -2px;\n\n  @media only screen and (max-width: 768px) {\n    margin-top: 0;\n  }\n"]))),X=k.ZP.span(h||(h=(0,b.Z)(["\n  height: 24px;\n  padding: 6px 6px;\n  font-size: 10px;\n  font-weight: 500;\n  border: 1px solid #666;\n  background-color: #eee;\n  cursor: pointer;\n\n  &.checked {\n    background-color: #666;\n    color: #fff;\n  }\n\n  &:hover {\n    opacity: 0.8;\n  }\n"]))),q=k.ZP.div(x||(x=(0,b.Z)(["\n  width: 20px;\n  height: 35px;\n  display: inline-block;\n  position: relative;\n\n  img.marker-img {\n    width: 60px;\n    height: 60px;\n    object-fit: cover;\n    border: 2px solid #05f;\n    position: absolute;\n    top: -40px;\n    left: -20px;\n  }\n\n  div.marker-arrow {\n    width: 20px;\n    height: 20px;\n    background-color: #05f;\n    border-top: 5px solid #05f;\n    border-left: 5px solid #05f;\n    transform: rotate(225deg);\n    position: absolute;\n    bottom: 5px;\n    left: 0px;\n  }\n\n  &:hover {\n    img.marker-img {\n      border: 2px solid #9bf;\n    }\n\n    div.marker-arrow {\n      background-color: #9bf;\n      border-top: 5px solid #9bf;\n      border-left: 5px solid #9bf;\n    }\n  }\n"]))),A=k.ZP.div(f||(f=(0,b.Z)(["\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  padding: 14px 21px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 4px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n\n  @media only screen and (max-width: 768px) {\n    font-size: 14px;\n    padding: 8px 14px;\n    background-color: #eee;\n    border-radius: 30px;\n  }\n"]))),K=k.ZP.div(m||(m=(0,b.Z)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 400px;\n\n  @media only screen and (max-width: 768px) {\n    width: 100%;\n    bottom: auto;\n    height: 400px;\n    right: 0;\n  }\n\n  @media only screen and (max-width: 730px) {\n    height: 300px;\n  }\n"]))),$=k.ZP.img(u||(u=(0,b.Z)(["\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  border-right: 1px solid #eee;\n  vertical-align: top;\n\n  @media only screen and (max-width: 768px) {\n    border-right: none;\n    border-bottom: 1px solid #eee;\n  }\n"]))),Q=k.ZP.div(g||(g=(0,b.Z)(["\n  position: absolute;\n  top: 0;\n  width: 400px;\n  bottom: 0;\n  right: 0;\n\n  .exif-title {\n    font-size: 20px;\n    line-height: 40px;\n    height: 40px;\n    padding-left: 10px;\n    border-bottom: 1px solid #eee;\n  }\n\n  .exif-details {\n    padding: 10px;\n    height: calc(100% - 40px);\n    overflow-y: scroll;\n\n    .exif-line {\n      .exif-line-key {\n        font-size: 10px;\n        display: inline-block;\n        width: 120px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-divider {\n        font-size: 10px;\n        display: inline-block;\n        width: 10px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n\n      .exif-line-value {\n        font-size: 10px;\n        display: inline-block;\n        width: 250px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        vertical-align: top;\n      }\n    }\n  }\n\n  @media only screen and (max-width: 768px) {\n    top: 400px;\n    width: 100%;\n\n    .exif-details {\n      .exif-line {\n        .exif-line-value {\n          width: calc(100% - 150px);\n        }\n      }\n    }\n  }\n\n  @media only screen and (max-width: 730px) {\n    top: 300px;\n  }\n"]))),V=k.ZP.div(w||(w=(0,b.Z)(["\n  position: absolute;\n  font-size: 10px;\n  top: 10px;\n  right: 10px;\n  padding: 2px 7px;\n  background-color: #eee;\n  border-radius: 30px;\n  cursor: pointer;\n  filter: drop-shadow(0 0 2px #777);\n\n  &:hover {\n    background-color: #ccc;\n  }\n"])))}}]);
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Route Beyond VPN | Yiming @ SeasonsRoad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Nowadays, I’m working in a corp environment. BTW, we have a wired VPN network to somewhere outside the GFW. And we also have a wireless network inside the GFW, witch means we can go to some websites m">
<meta property="og:type" content="website">
<meta property="og:title" content="Route Beyond VPN">
<meta property="og:url" content="http://seasonsroad.com/RouteBeyondVPN/index.html">
<meta property="og:site_name" content="Yiming @ SeasonsRoad">
<meta property="og:description" content="Nowadays, I’m working in a corp environment. BTW, we have a wired VPN network to somewhere outside the GFW. And we also have a wireless network inside the GFW, witch means we can go to some websites m">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Route Beyond VPN">
<meta name="twitter:description" content="Nowadays, I’m working in a corp environment. BTW, we have a wired VPN network to somewhere outside the GFW. And we also have a wireless network inside the GFW, witch means we can go to some websites m">
  
    <link rel="alternative" href="/atom.xml" title="Yiming @ SeasonsRoad" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-nav" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Good Morning!</a>
      </h1>
      <nav id="main-nav">
        <ul class="mod-head__ul">
        
          <li class="main-nav-link"><a href="/">Home</a></li>
        
          <li class="main-nav-link"><a href="/links.html">Links</a></li>
        
          <li class="main-nav-link"><a href="https://github.com/yiminglu">Github</a></li>
        
          <li class="main-nav-link"><a href="/about.html">About</a></li>
        
        </ul>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="inner">
        <section id="main"><article id="page-undefined" class="article article-type-page" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      <a href="/RouteBeyondVPN/index.html">
        Route Beyond VPN
      </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Nowadays, I’m working in a corp environment. BTW, we have a wired VPN network to somewhere outside the GFW. And we also have a wireless network inside the GFW, witch means we can go to some websites more quickly, like baidu and some music websites, and also some websites we can never go beyond VPN, like google and corp network.</p>
<p>When I have to set the service order for these two networks a lot! Also, sometimes I need both networks, it means that, I want to change to wireless network but I can’t disconnet from the wired network! This drives me crazy. I don’t know why others people are still living, well!</p>
<p>So I need to find a way to utilize both networks.</p>
<h1 id="Is_there_a_way?">Is there a way?</h1><p>Yes, there is a way!</p>
<h2 id="How?_What’s_the_way?">How? What’s the way?</h2><p>We can use both connected network, even the MacOS has setup a default network.<br>Every network we connected has a gateway. We will go through the network only when we direct the destination IP into its gateway(From a colleague’s idea).</p>
<h1 id="Do_it!">Do it!</h1><h2 id="Get_the_IP_list-">Get the IP list.</h2><p>So we need to update all the IPs we need for the wireless network to its gateway.</p>
<p>Wow! All the IPs! But there’s a way to get them!</p>
<p><a href="https://github.com/fivesheep/chnroutes" target="_blank" rel="external">ChnRoutes</a> has made all the IPs I want to use! ChnRoutes lists all the IPs inside China, so I route them to the gateway of Wireless network. Download the list from <a href="https://chnroutes-dl.appspot.com/" target="_blank" rel="external">https://chnroutes-dl.appspot.com/</a>.</p>
<p>We’d better download the Mac.zip, since it’s the easiest way to modify.</p>
<blockquote>
<p>If we’re conneted to a VPN locally, we can easily run the scripts inside the zip file.<br>To route, use <code>sudo sh ip-up</code>. And to remove the routes, use <code>sudo sh ip-down</code>.<br>In my circumstance, I need to do the following steps.</p>
</blockquote>
<h2 id="Get_the_connected_Gateways-">Get the connected Gateways.</h2><p>In MacOS, there’s a bash command to get all the conneted Gateways(the script we downloaded has this command):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -nr | grep <span class="string">'^default'</span> | grep -v <span class="string">'ppp'</span> | sed <span class="string">'s/default *\([0-9\.]*\) .*/\1/'</span></span><br></pre></td></tr></table></figure>
<p>Through this command, we get all the gateways except the ppp ones, and you should be able to find which gateway is for a certain network.<br>So we get these gateways:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wired network:    10.20.0.1&#10;wireless network: 10.20.10.1</span><br></pre></td></tr></table></figure>
<h2 id="Route_all_the_IPs!">Route all the IPs!</h2><p>We are going to modify the scripts we downloaded.</p>
<p>Modify this line:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OLDGW=`netstat -nr | grep <span class="string">'^default'</span> | grep -v <span class="string">'ppp'</span> | sed <span class="string">'s/default *\([0-9\.]*\) .*/\1/'</span><span class="number">180</span>`</span><br></pre></td></tr></table></figure></p>
<p>Into:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OLDGW=<span class="variable">$1</span></span><br></pre></td></tr></table></figure></p>
<p>Then, we can pass our gateway IP as a parameter.</p>
<p>Run this to route &amp; unroute:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#route</span></span><br><span class="line">sudo sh ip-up <span class="number">10.20</span>.<span class="number">10.1</span></span><br><span class="line"><span class="comment">#unroute</span></span><br><span class="line">sudo sh ip-down</span><br></pre></td></tr></table></figure></p>
<h1 id="Done">Done</h1><p>After this, we’ve made the most part of it. What’s more, you can write a script to judge whether you’ve already routed the Gateway. Route it when it’s not done, and unroute it when it’s done.</p>

      
    </div>
    
  </div>
  
</article>


</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
	<div id="footer-info" class="inner">
	&copy; 2016 Yiming LU<br>
	Hosted on <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.
	</div>
  </div>
</footer>
    </div>
    
<script>
  var disqus_shortname = 'ymlu';
  
  var disqus_url = 'http://seasonsroad.com/RouteBeyondVPN/index.html';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

  </div>
</body>
</html>